  완료된 작업 (`vmtest` 폴더 내):

   1. Node.js 애플리케이션: package.json, index.js
   2. 컨테이너화 설정: Dockerfile
   3. Kubernetes 배포 설정: k8s/deployment.yaml, k8s/service.yaml
   4. CI/CD 파이프라인: Jenkinsfile (빌드 → 테스트 → 이미지 생성 → Harbor 푸시 → K8s 배포)

  ---

  가장 중요한 다음 단계: Jenkins 설정

  Jenkinsfile이 올바르게 동작하려면 Jenkins 시스템에 몇 가지 중요한 설정이 필요합니다.

  1. Jenkins 에이전트(서버) 설정

  파이프라인을 실행하는 Jenkins 에이전트(또는 마스터)에 다음 작업이 반드시 선행되어야 합니다.

   * 필수 도구 설치: docker, kubectl, node (Node.js)가 설치되어 있어야 합니다.
   * Harbor 'Insecure Registry' 등록 (매우 중요):
      Harbor가 사설 IP(192.168.63.99)에서 실행되므로, Docker는 기본적으로 보안되지 않은 레지스트리로 간주하여 이미지 푸시를 차단합니다. 이를 해결하려면 Jenkins 에이전트 서버에서 아래와 같이 Docker 데몬 설정을 변경해야 합니다.

       * /etc/docker/daemon.json 파일을 열고 아래 내용을 추가 (파일이 없으면 새로 생성) 하고 Docker를 재시작하세요.

   1     {
   2       "insecure-registries" : ["192.168.63.99"]
   3     }

       * Docker 재시작 명령어: sudo systemctl restart docker

  2. Jenkins Credentials 생성

  Jenkins가 Harbor와 Kubernetes에 접근할 수 있도록 접속 정보를 Credentials에 안전하게 등록해야 합니다.

   * Harbor 로그인 정보:
       * 경로: Manage Jenkins > Credentials > System > Global credentials > Add Credentials
       * Kind: Username with password
       * Username: Harbor 사용자 ID
       * Password: Harbor 사용자 비밀번호
       * ID: harbor-credentials  (✅ Jenkinsfile에 지정된 것과 정확히 일치해야 합니다)

   * Kubernetes 클러스터 접속 정보:
       * 경로: 위와 동일
       * Kind: Secret file
       * File: K8s 마스터 노드(192.168.63.97)에 접속할 수 있는 kubeconfig 파일을 업로드합니다. (보통 ~/.kube/config 경로에 있습니다)
       * ID: kubeconfig-credentials (✅ Jenkinsfile에 지정된 것과 정확히 일치해야 합니다)

  3. 파이프라인 실행

   1. 지금까지 생성된 vmtest 폴더 전체를 GitHub 등 원격 Git 저장소에 푸시합니다.
   2. Jenkins에서 New Item > Pipeline 프로젝트를 생성하고, Pipeline script from SCM 옵션을 통해 Git 저장소를 연결합니다.
   3. Build Now를 실행하면 파이프라인이 작동하여 Harbor에 이미지를 올리고 Kubernetes에 자동으로 배포합니다.

  4. 배포된 애플리케이션 확인

  배포가 성공적으로 완료되면, 서비스 YAML에 설정한 대로 워커 노드의 IP와 NodePort를 통해 앱에 접속할 수 있습니다.

   * 접속 주소: http://192.168.63.98:30080

  위 설정들을 마치고 파이프라인을 실행하면, 코드 변경 시 자동으로 K8s 클러스터에 배포되는 CI/CD 환경이 완성됩니다.     